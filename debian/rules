#!/usr/bin/make -f

export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
	dh $@

override_dh_auto_build:
	cargo build --release --bins

override_dh_auto_install:
	# Install binaries
	install -D -m755 target/release/lx-hw-detect debian/lx-hw-db/usr/bin/lx-hw-detect
	install -D -m755 target/release/lx-hw-indexer debian/lx-hw-db/usr/bin/lx-hw-indexer
	
	# Install man pages
	install -D -m644 docs/man/lx-hw-detect.1 debian/lx-hw-db/usr/share/man/man1/lx-hw-detect.1
	install -D -m644 docs/man/lx-hw-indexer.1 debian/lx-hw-db/usr/share/man/man1/lx-hw-indexer.1
	
	# Install configuration files
	install -D -m644 config/default.toml debian/lx-hw-db/etc/lx-hw-db/config.toml
	
	# Install web interface (optional)
	mkdir -p debian/lx-hw-db/usr/share/lx-hw-db/web
	cp -r web/* debian/lx-hw-db/usr/share/lx-hw-db/web/
	
	# Install systemd service (optional)
	install -D -m644 packaging/systemd/lx-hw-db-server.service debian/lx-hw-db/lib/systemd/system/lx-hw-db-server.service

override_dh_auto_test:
	cargo test --release

override_dh_auto_clean:
	cargo clean